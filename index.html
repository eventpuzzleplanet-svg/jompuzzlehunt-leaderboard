<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#4a90e2" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>Leaderboard</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg:#f4f4f4;
      --brand:#4a90e2;
      --brand2:#357ab7;
      --text:#222;
      --muted:#666;
      --card:#ffffff;
      --shadow:0 10px 25px rgba(0,0,0,0.25);
      --radius:20px;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }

    html { height: 100%; -webkit-text-size-adjust: 100%; text-size-adjust: 100%; }
    body {
      margin: 0;
      min-height: 100dvh;
      font-family: 'Roboto', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      text-align: center;
      background: var(--bg) url('background.png') no-repeat center center fixed;
      background-size: cover;
      background-attachment: fixed;
      padding: calc(var(--safe-top) + 8px) calc(var(--safe-right) + 8px) calc(var(--safe-bottom) + 16px) calc(var(--safe-left) + 8px);
      -webkit-tap-highlight-color: transparent;
    }

    .top-left-logo {
      position: fixed;
      top: calc(var(--safe-top) + 12px);
      left: calc(var(--safe-left) + 12px);
      height: clamp(28px, 8vw, 44px);
      max-width: 30vw;
      object-fit: contain;
      z-index: 20;
    }

    .top-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 24px 0 8px;
      gap: 8px;
      padding-top: 8px;
    }

    .top-center img {
      height: clamp(64px, 18vw, 120px);
      width: auto;
      max-width: 80vw;
      object-fit: contain;
    }

    .top-center h1 {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      font-size: clamp(22px, 4.5vw, 36px);
      font-weight: 700;
      color: var(--text);
      letter-spacing: .5px;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 8px 12px;
      margin: 6px 0 10px;
    }

    .tab-btn {
      min-height: 44px;
      min-width: 100px;
      padding: 10px 18px;
      border: none;
      border-radius: 12px;
      background: #e9e9e9;
      color: #111;
      cursor: pointer;
      font-size: clamp(14px, 3.8vw, 16px);
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      transition: background .2s, transform .1s;
    }

    .tab-btn:active { transform: scale(.98); }
    .tab-btn:hover { background: #dcdcdc; }
    .tab-btn.active { background: var(--brand); color: #fff; }

    .leaderboard {
      max-width: 720px;
      margin: 12px auto 60px;
      background: rgba(255,255,255,0.96);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      padding: 8px;
      display: none;
    }

    .table-wrap {
      width: 100%;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      border-radius: 14px;
      outline: 1px solid rgba(0,0,0,0.06);
      max-height: 68dvh;
      background: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    th, td {
      padding: 14px 16px;
      border-bottom: 1px solid #eee;
      text-align: left;
      vertical-align: middle;
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
    }

    /* Rank column */
    th:first-child,
    td:first-child {
      width: 50px;
      text-align: center;
      border-bottom: none !important;
    }

    /* Time column */
    th:nth-child(3),
    td:nth-child(3) {
      width: 88px;
      text-align: center;
      white-space: nowrap;
    }

    /* Score column */
    th:last-child,
    td:last-child {
      width: 70px;
      text-align: center;
    }

    /* Name column: takes all remaining space */
    th:nth-child(2),
    td:nth-child(2) {
      width: auto;
      white-space: normal;
      word-break: break-word;
      overflow-wrap: anywhere;
      line-height: 1.35;
      text-align: left;
    }

    td:nth-child(2) div {
      display: block;
      margin: 2px 0 0;
      white-space: normal;
    }

    .rank-cell {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
    }

    .rank-cell img { height: 20px; }

    thead th {
      position: sticky;
      top: 0;
      z-index: 5;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      color: #fff;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    tbody tr:nth-child(even){ background:#fafafa; }
    tbody tr:nth-child(odd){ background:#fff; }
    tbody tr:hover{ background:#eef5ff; transition: background .2s; }

    .podium-1 { background: #ffeaa7 !important; font-weight: 700; }
    .podium-2 { background: #dfe6e9 !important; font-weight: 700; }
    .podium-3 { background: #fab1a0 !important; font-weight: 700; }

    .podium-1 td,
    .podium-2 td,
    .podium-3 td {
      border-bottom: none !important;
    }

    /* Responsive tweaks */
    @media (max-width: 480px) {
      th, td {
        padding: 10px 8px;
        font-size: 13px;
      }

      th:nth-child(3),
      td:nth-child(3) {
        width: 44px;
        font-size: 12px;
      }

      th:nth-child(2),
      td:nth-child(2) {
        font-size: 13px;
      }

      td:nth-child(2) div {
        font-size: 13px;
      }
    }

    @media (max-width: 360px) {
      th, td {
        font-size: 12px;
        padding: 8px 6px;
      }

      th:nth-child(3),
      td:nth-child(3) {
        width: 66px;
      }

      td:nth-child(2) div {
        font-size: 12px;
      }
    }

    @media (max-width: 400px){
      .top-center img {
        height: 110px;
        max-width: 90vw;
      }
    }

    @media (prefers-reduced-motion: reduce){
      * { animation: none !important; transition: none !important; }
    }
  </style>
</head>
<body>

  <!-- Top-left Logo -->
  <img src="logo.png" alt="Top Left Logo" class="top-left-logo" loading="lazy" />

  <!-- Top Center Logo then Title -->
  <div class="top-center">
    <img src="jom logo.png" alt="Logo" loading="lazy" />
    <h1>Leaderboard</h1>
  </div>

  <!-- Tabs -->
  <div class="tabs" id="tabs">
    <button class="tab-btn" onclick="switchTab('solo')">Solo</button>
    <button class="tab-btn" onclick="switchTab('pair')">Pair</button>
  </div>

  <!-- Card + Table -->
  <div class="leaderboard" id="leaderboardBox" aria-live="polite">
    <div class="table-wrap">
      <table id="leaderboardTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Name</th>
            <th>Time</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody><!-- filled by JS --></tbody>
      </table>
    </div>
  </div>

  <script>
    function timeToSeconds(str) {
      const parts = (str || '').trim().split(':').map(Number);
      if (parts.some(n => Number.isNaN(n))) return Infinity;
      if (parts.length === 3) return parts[0]*3600 + parts[1]*60 + parts[2];
      if (parts.length === 2) return parts[0]*60 + parts[1];
      return Number(str);
    }

    function smoothScrollIntoView(el){
      if(!el) return;
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      el.scrollIntoView({ behavior: prefersReduced ? 'auto' : 'smooth', block: 'start' });
    }

    async function loadCSV(file) {
      const tbody = document.querySelector('#leaderboardTable tbody');
      tbody.innerHTML = "";

      try {
        const response = await fetch(file, { cache: 'no-store' });
        if (!response.ok) throw new Error("File not found");
        const text = await response.text();

        const lines = text.trim().split(/\r?\n/);
        const first = (lines[0] || '').toLowerCase();
        const hasHeader = first.includes('name') && first.includes('time');

        let header = ['name','time','score'];
        let dataLines = lines;

        if (hasHeader) {
          header = lines[0].split(',').map(h => h.trim().toLowerCase());
          dataLines = lines.slice(1);
        }

        const nameI = header.indexOf('name') !== -1 ? header.indexOf('name') : header.indexOf('name1');
        const name2I = header.indexOf('name2');
        const timeI = header.indexOf('time');
        const scoreI = header.indexOf('score') !== -1 ? header.indexOf('score') : header.indexOf('points');

        const rows = dataLines
          .map(l => l.split(',').map(s => s.trim()))
          .filter(cols => cols.length >= 2 && (cols[nameI] || '').length);

        const data = rows.map(cols => ({
          name: name2I !== -1 ? `${cols[nameI]}|${cols[name2I]}` : cols[nameI],
          timeStr: cols[timeI] || '',
          timeSec: timeToSeconds(cols[timeI] || ''),
          score: scoreI >= 0 ? (cols[scoreI] || '0') : '0'
        }));

        data.sort((a, b) => a.timeSec - b.timeSec || a.name.localeCompare(b.name));

        data.forEach((d, idx) => d.rank = idx + 1);

        if (!data.length) {
          tbody.innerHTML = `<tr><td colspan="4" style="text-align:center; font-style:italic; color:#888; font-family:'Poppins',sans-serif;">Coming soon</td></tr>`;
          return;
        }

        data.forEach(d => {
          const tr = document.createElement('tr');
          if (d.rank === 1) tr.classList.add('podium-1');
          else if (d.rank === 2) tr.classList.add('podium-2');
          else if (d.rank === 3) tr.classList.add('podium-3');

          const medalImg = d.rank === 1 ? 'gold.png' : d.rank === 2 ? 'silver.png' : d.rank === 3 ? 'bronze.png' : '';
          const medalTag = medalImg
            ? `<img src="${medalImg}" alt="medal" loading="lazy" onerror="this.replaceWith(document.createTextNode('${d.rank===1?'ðŸ¥‡':d.rank===2?'ðŸ¥ˆ':d.rank===3?'ðŸ¥‰':''}'))">`
            : '';

          tr.innerHTML = `
            <td class="rank-cell"><span>${d.rank}</span>${medalTag}</td>
            <td>${d.name.includes('|') ? d.name.split('|').map(n => `<div>${n}</div>`).join('') : d.name}</td>
            <td>${d.timeStr}</td>
            <td>${d.score}</td>
          `;
          tbody.appendChild(tr);
        });

      } catch (err) {
        console.error(err);
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center; font-style:italic; color:#888; font-family:'Poppins',sans-serif;">Coming soon</td></tr>`;
      }
    }

    function switchTab(tab) {
      const leaderboardBox = document.getElementById("leaderboardBox");
      leaderboardBox.style.display = "block";
      leaderboardBox.classList.remove("fade-animation");
      void leaderboardBox.offsetWidth;
      leaderboardBox.classList.add("fade-animation");

      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

      const files = {
        solo: 'data1.csv',
        pair: 'data2.csv'
      };

      const index = (tab === 'solo') ? 0 : 1;
      document.querySelectorAll('.tab-btn')[index].classList.add('active');
      loadCSV(files[tab]);

      smoothScrollIntoView(leaderboardBox);
    }

    window.addEventListener('DOMContentLoaded', () => switchTab('solo'));
  </script>
</body>
</html>
